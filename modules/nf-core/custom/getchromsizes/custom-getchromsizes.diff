Changes in module 'nf-core/custom/getchromsizes'
--- modules/nf-core/custom/getchromsizes/meta.yml
+++ modules/nf-core/custom/getchromsizes/meta.yml
@@ -12,53 +12,38 @@
       tool_dev_url: https://github.com/samtools/samtools
       doi: 10.1093/bioinformatics/btp352
       licence: ["MIT"]
-      identifier: ""
 input:
-  - meta:
-      type: map
-      description: |
-        Groovy Map containing sample information
-        e.g. [ id:'test', single_end:false ]
-    - fasta:
-        type: file
-        description: FASTA file
-        pattern: "*.{fa,fasta,fna,fas}"
+  - meta:
+      type: map
+      description: |
+        Groovy Map containing sample information
+        e.g. [ id:'test', single_end:false ]
+  - fasta:
+      type: file
+      description: FASTA file
+      pattern: "*.{fa,fasta,fna,fas}"
 output:
+  - meta:
+      type: map
+      description: |
+        Groovy Map containing sample information
+        e.g. [ id:'test', single_end:false ]
   - sizes:
-      - meta:
-          type: map
-          description: |
-            Groovy Map containing sample information
-            e.g. [ id:'test', single_end:false ]
-      - "*.sizes":
-          type: file
-          description: File containing chromosome lengths
-          pattern: "*.{sizes}"
+      type: file
+      description: File containing chromosome lengths
+      pattern: "*.{sizes}"
   - fai:
-      - meta:
-          type: map
-          description: |
-            Groovy Map containing sample information
-            e.g. [ id:'test', single_end:false ]
-      - "*.fai":
-          type: file
-          description: FASTA index file
-          pattern: "*.{fai}"
+      type: file
+      description: FASTA index file
+      pattern: "*.{fai}"
   - gzi:
-      - meta:
-          type: map
-          description: |
-            Groovy Map containing sample information
-            e.g. [ id:'test', single_end:false ]
-      - "*.gzi":
-          type: file
-          description: Optional gzip index file for compressed inputs
-          pattern: "*.gzi"
+      type: file
+      description: Optional gzip index file for compressed inputs
+      pattern: "*.gzi"
   - versions:
-      - versions.yml:
-          type: file
-          description: File containing software versions
-          pattern: "versions.yml"
+      type: file
+      description: File containing software versions
+      pattern: "versions.yml"
 authors:
   - "@tamara-hodgetts"
   - "@chris-cheshire"

--- modules/nf-core/custom/getchromsizes/main.nf
+++ modules/nf-core/custom/getchromsizes/main.nf
@@ -4,26 +4,31 @@
 
     conda "${moduleDir}/environment.yml"
     container "${ workflow.containerEngine == 'singularity' && !task.ext.singularity_pull_docker_container ?
-        'https://depot.galaxyproject.org/singularity/samtools:1.21--h50ea8bc_0' :
-        'biocontainers/samtools:1.21--h50ea8bc_0' }"
+        'https://depot.galaxyproject.org/singularity/samtools:1.16.1--h6899075_1' :
+        'biocontainers/samtools:1.16.1--h6899075_1' }"
 
     input:
-    tuple val(meta), path(fasta)
+    tuple   val(meta), path(fasta, stageAs: 'input/*')
+    val     suffix
 
     output:
-    tuple val(meta), path ("*.sizes"), emit: sizes
-    tuple val(meta), path ("*.fai")  , emit: fai
-    tuple val(meta), path ("*.gzi")  , emit: gzi, optional: true
-    path  "versions.yml"             , emit: versions
+    tuple val(meta), path ("*.${suffix}")   , emit: sizes
+    tuple val(meta), path ("*.fa")          , emit: fasta
+    tuple val(meta), path ("*.fai")         , emit: fai
+    tuple val(meta), path ("*.gzi")         , emit: gzi, optional: true
+    path  "versions.yml"                    , emit: versions
 
     when:
     task.ext.when == null || task.ext.when
 
     script:
-    def args = task.ext.args ?: ''
+    def args    = task.ext.args ?: ''
+    def prefix  = task.ext.prefix ?: "${meta.id}"
     """
-    samtools faidx $fasta
-    cut -f 1,2 ${fasta}.fai > ${fasta}.sizes
+
+    ln -s ${fasta} ${prefix}.fa
+    samtools faidx ${prefix}.fa -o ${prefix}.fa.fai
+    cut -f 1,2 ${prefix}.fa.fai > ${prefix}.${suffix}
 
     cat <<-END_VERSIONS > versions.yml
     "${task.process}":
@@ -33,11 +38,9 @@
 
     stub:
     """
-    touch ${fasta}.fai
-    touch ${fasta}.sizes
-    if [[ "${fasta.extension}" == "gz" ]]; then
-        touch ${fasta}.gzi
-    fi
+    touch ${prefix}.fa
+    touch ${prefix}.fa.fai
+    touch ${prefix}.${suffix}
 
     cat <<-END_VERSIONS > versions.yml
     "${task.process}":

--- modules/nf-core/custom/getchromsizes/environment.yml
+++ modules/nf-core/custom/getchromsizes/environment.yml
@@ -1,7 +1,6 @@
 channels:
   - conda-forge
   - bioconda
-
+  - defaults
 dependencies:
-  - bioconda::htslib=1.21
-  - bioconda::samtools=1.21
+  - bioconda::samtools=1.16.1

--- modules/nf-core/custom/getchromsizes/tests/main.nf.test
+++ modules/nf-core/custom/getchromsizes/tests/main.nf.test
@@ -12,12 +12,14 @@
     test("test_custom_getchromsizes") {
 
         when {
+            params {
+                outdir = "$outputDir"
+            }
             process {
                 """
-                input[0] = Channel.of([
-                    [ id:'test' ], // meta map
-                    file(params.modules_testdata_base_path + 'genomics/sarscov2/genome/genome.fasta', checkIfExists: true)
-                ])
+                input[0] = [ [ id:'test', single_end:false ], // meta map
+                             file(params.test_data['sarscov2']['genome']['genome_fasta'], checkIfExists: true)
+                           ]
                 """
             }
         }
@@ -28,17 +30,20 @@
                 { assert snapshot(process.out).match() }
             )
         }
+
     }
 
     test("test_custom_getchromsizes_bgzip") {
 
         when {
+            params {
+                outdir = "$outputDir"
+            }
             process {
                 """
-                input[0] = Channel.of([
-                    [ id:'test' ], // meta map
-                    file(params.modules_testdata_base_path + 'genomics/sarscov2/genome/genome.fasta.gz', checkIfExists: true)
-                ])
+                input[0] = [ [ id:'test', single_end:false ], // meta map
+                             file(params.test_data['sarscov2']['genome']['genome_fasta_gz'], checkIfExists: true)
+                           ]
                 """
             }
         }
@@ -49,51 +54,7 @@
                 { assert snapshot(process.out).match() }
             )
         }
+
     }
 
-    test("test_custom_getchromsizes - stub") {
-
-        options "-stub"
-
-        when {
-            process {
-                """
-                input[0] = Channel.of([
-                    [ id:'test' ], // meta map
-                    file(params.modules_testdata_base_path + 'genomics/sarscov2/genome/genome.fasta', checkIfExists: true)
-                ])
-                """
-            }
-        }
-
-        then {
-            assertAll (
-                { assert process.success },
-                { assert snapshot(process.out).match() }
-            )
-        }
-    }
-
-    test("test_custom_getchromsizes_bgzip - stub") {
-
-        options "-stub"
-
-        when {
-            process {
-                """
-                input[0] = Channel.of([
-                    [ id:'test' ], // meta map
-                    file(params.modules_testdata_base_path + 'genomics/sarscov2/genome/genome.fasta.gz', checkIfExists: true)
-                ])
-                """
-            }
-        }
-
-        then {
-            assertAll (
-                { assert process.success },
-                { assert snapshot(process.out).match() }
-            )
-        }
-    }
 }

--- modules/nf-core/custom/getchromsizes/tests/main.nf.test.snap
+++ modules/nf-core/custom/getchromsizes/tests/main.nf.test.snap
@@ -1,76 +1,12 @@
 {
-    "test_custom_getchromsizes_bgzip - stub": {
-        "content": [
-            {
-                "0": [
-                    [
-                        {
-                            "id": "test"
-                        },
-                        "genome.fasta.gz.sizes:md5,d41d8cd98f00b204e9800998ecf8427e"
-                    ]
-                ],
-                "1": [
-                    [
-                        {
-                            "id": "test"
-                        },
-                        "genome.fasta.gz.fai:md5,d41d8cd98f00b204e9800998ecf8427e"
-                    ]
-                ],
-                "2": [
-                    [
-                        {
-                            "id": "test"
-                        },
-                        "genome.fasta.gz.gzi:md5,d41d8cd98f00b204e9800998ecf8427e"
-                    ]
-                ],
-                "3": [
-                    "versions.yml:md5,f68edc4d5999d8cb07147b9be115d60b"
-                ],
-                "fai": [
-                    [
-                        {
-                            "id": "test"
-                        },
-                        "genome.fasta.gz.fai:md5,d41d8cd98f00b204e9800998ecf8427e"
-                    ]
-                ],
-                "gzi": [
-                    [
-                        {
-                            "id": "test"
-                        },
-                        "genome.fasta.gz.gzi:md5,d41d8cd98f00b204e9800998ecf8427e"
-                    ]
-                ],
-                "sizes": [
-                    [
-                        {
-                            "id": "test"
-                        },
-                        "genome.fasta.gz.sizes:md5,d41d8cd98f00b204e9800998ecf8427e"
-                    ]
-                ],
-                "versions": [
-                    "versions.yml:md5,f68edc4d5999d8cb07147b9be115d60b"
-                ]
-            }
-        ],
-        "meta": {
-            "nf-test": "0.9.0",
-            "nextflow": "24.04.4"
-        },
-        "timestamp": "2024-10-18T10:11:37.459094476"
-    },
     "test_custom_getchromsizes": {
         "content": [
             {
                 "0": [
                     [
                         {
-                            "id": "test"
+                            "id": "test",
+                            "single_end": false
                         },
                         "genome.fasta.sizes:md5,a57c401f27ae5133823fb09fb21c8a3c"
                     ]
@@ -78,7 +14,8 @@
                 "1": [
                     [
                         {
-                            "id": "test"
+                            "id": "test",
+                            "single_end": false
                         },
                         "genome.fasta.fai:md5,9da2a56e2853dc8c0b86a9e7229c9fe5"
                     ]
@@ -87,12 +24,13 @@
                     
                 ],
                 "3": [
-                    "versions.yml:md5,f68edc4d5999d8cb07147b9be115d60b"
+                    "versions.yml:md5,45a83c5f3dddbc5dcab30035169f7ce8"
                 ],
                 "fai": [
                     [
                         {
-                            "id": "test"
+                            "id": "test",
+                            "single_end": false
                         },
                         "genome.fasta.fai:md5,9da2a56e2853dc8c0b86a9e7229c9fe5"
                     ]
@@ -103,21 +41,18 @@
                 "sizes": [
                     [
                         {
-                            "id": "test"
+                            "id": "test",
+                            "single_end": false
                         },
                         "genome.fasta.sizes:md5,a57c401f27ae5133823fb09fb21c8a3c"
                     ]
                 ],
                 "versions": [
-                    "versions.yml:md5,f68edc4d5999d8cb07147b9be115d60b"
+                    "versions.yml:md5,45a83c5f3dddbc5dcab30035169f7ce8"
                 ]
             }
         ],
-        "meta": {
-            "nf-test": "0.9.0",
-            "nextflow": "24.04.4"
-        },
-        "timestamp": "2024-10-18T10:11:01.526301351"
+        "timestamp": "2023-10-17T10:20:42.652464"
     },
     "test_custom_getchromsizes_bgzip": {
         "content": [
@@ -125,7 +60,8 @@
                 "0": [
                     [
                         {
-                            "id": "test"
+                            "id": "test",
+                            "single_end": false
                         },
                         "genome.fasta.gz.sizes:md5,a57c401f27ae5133823fb09fb21c8a3c"
                     ]
@@ -133,7 +69,8 @@
                 "1": [
                     [
                         {
-                            "id": "test"
+                            "id": "test",
+                            "single_end": false
                         },
                         "genome.fasta.gz.fai:md5,9da2a56e2853dc8c0b86a9e7229c9fe5"
                     ]
@@ -141,18 +78,20 @@
                 "2": [
                     [
                         {
-                            "id": "test"
+                            "id": "test",
+                            "single_end": false
                         },
                         "genome.fasta.gz.gzi:md5,7dea362b3fac8e00956a4952a3d4f474"
                     ]
                 ],
                 "3": [
-                    "versions.yml:md5,f68edc4d5999d8cb07147b9be115d60b"
+                    "versions.yml:md5,45a83c5f3dddbc5dcab30035169f7ce8"
                 ],
                 "fai": [
                     [
                         {
-                            "id": "test"
+                            "id": "test",
+                            "single_end": false
                         },
                         "genome.fasta.gz.fai:md5,9da2a56e2853dc8c0b86a9e7229c9fe5"
                     ]
@@ -160,7 +99,8 @@
                 "gzi": [
                     [
                         {
-                            "id": "test"
+                            "id": "test",
+                            "single_end": false
                         },
                         "genome.fasta.gz.gzi:md5,7dea362b3fac8e00956a4952a3d4f474"
                     ]
@@ -168,75 +108,17 @@
                 "sizes": [
                     [
                         {
-                            "id": "test"
+                            "id": "test",
+                            "single_end": false
                         },
                         "genome.fasta.gz.sizes:md5,a57c401f27ae5133823fb09fb21c8a3c"
                     ]
                 ],
                 "versions": [
-                    "versions.yml:md5,f68edc4d5999d8cb07147b9be115d60b"
+                    "versions.yml:md5,45a83c5f3dddbc5dcab30035169f7ce8"
                 ]
             }
         ],
-        "meta": {
-            "nf-test": "0.9.0",
-            "nextflow": "24.04.4"
-        },
-        "timestamp": "2024-10-18T10:11:14.32456385"
-    },
-    "test_custom_getchromsizes - stub": {
-        "content": [
-            {
-                "0": [
-                    [
-                        {
-                            "id": "test"
-                        },
-                        "genome.fasta.sizes:md5,d41d8cd98f00b204e9800998ecf8427e"
-                    ]
-                ],
-                "1": [
-                    [
-                        {
-                            "id": "test"
-                        },
-                        "genome.fasta.fai:md5,d41d8cd98f00b204e9800998ecf8427e"
-                    ]
-                ],
-                "2": [
-                    
-                ],
-                "3": [
-                    "versions.yml:md5,f68edc4d5999d8cb07147b9be115d60b"
-                ],
-                "fai": [
-                    [
-                        {
-                            "id": "test"
-                        },
-                        "genome.fasta.fai:md5,d41d8cd98f00b204e9800998ecf8427e"
-                    ]
-                ],
-                "gzi": [
-                    
-                ],
-                "sizes": [
-                    [
-                        {
-                            "id": "test"
-                        },
-                        "genome.fasta.sizes:md5,d41d8cd98f00b204e9800998ecf8427e"
-                    ]
-                ],
-                "versions": [
-                    "versions.yml:md5,f68edc4d5999d8cb07147b9be115d60b"
-                ]
-            }
-        ],
-        "meta": {
-            "nf-test": "0.9.0",
-            "nextflow": "24.04.4"
-        },
-        "timestamp": "2024-10-18T10:11:26.505487624"
+        "timestamp": "2023-10-17T10:22:25.185203"
     }
 }
************************************************************
